# Consequences {#consequences}

```{r, eval = FALSE}
library(ddata)
library(dscore)
library(haven)
library(dplyr)
library(tibble)
library(lme4)
library(MASS)
library(ggplot2)
```

## Application III: Long-term health consequences of delay in pre-terms

## Relevance of long-term health outcomes

## Predictive power of D-score

To demonstrate the predictive power of the D-score, we will predict IQ at the age of 5 years for children in the SMOCC dataset. We have data for nine different waves, that include children of the following ages:

- wave 1: 1 month
- wave 2: 2 months
- wave 3: 3 months
- wave 4: 6 months
- wave 5: 9 months
- wave 6: 12 months
- wave 7: 15 months
- wave 8: 18 months
- wave 9: 24 months

First, we will plot the D-scores against IQ at 5 years for each of the waves. In this way, we can see the variation in D-scores for the different waves and how this relates to IQ at the age of 5 years.
```{r, echo = FALSE}
#smocc <- get_gcdg(study="Netherlands 1", adm = T, cov=T)
#geg5jaar <- haven::read_sav("//365tno.sharepoint.com@SSL/DavWWWRoot/teams/P060.33452/TeamDocuments/Team/Work/Booklets/Data/geg5jaar.sav")

#Hou alleen de interessante variabelen van geg5jaar.
#Interessante uitkomst variabelen:
# - IQ
#sub.geg5jaar <- subset(geg5jaar, select = c("PNR", "IQ"))
#names(sub.geg5jaar) <- c("id", "IQ")

#data.smocc <- left_join(smocc, sub.geg5jaar, "id") #age is in maanden!

#van 198 kinderen D-score niet berekend omdat de leeftijd ontbrak.
#WILLEN WE HIER NOG IETS MEE DOEN?!
#LEEFTIJD INVULLEN OP BASIS VAN WAVE? MI?

#Subset van de data zonder de losse scores op de items:
data.long <- haven::read_sav("//365tno.sharepoint.com@SSL/DavWWWRoot/teams/P060.33452/TeamDocuments/Team/Work/Booklets/Data/smocc_long.sav")
data.long <- as_tibble(data.long)
data.wide <- haven::read_sav("//365tno.sharepoint.com@SSL/DavWWWRoot/teams/P060.33452/TeamDocuments/Team/Work/Booklets/Data/smocc_wide.sav")
data.wide <- as_tibble(data.wide)
```

```{r, echo = FALSE}
data.long$wave <- factor(data.long$wave)
data.long1 <- data.long[!is.na(data.long$IQ), ]
data.long1 <- data.long1[!is.na(data.long1$dscore), ]

p <- ggplot(data.long1, aes(dscore, IQ, group = wave)) +
      geom_point(aes(col = wave)) +
      coord_cartesian(xlim=c(0, 75)) +
      scale_y_continuous(name = "IQ at 5 years") +
      scale_x_continuous(name = "D-score")
p
```

Moreover, we can model IQ at 5 years old for each wave separately, which allows us to compare the effect of the D-score at each wave on the variation in IQ at 5 years. To predict IQ at 5 years, the following predictor variables are added to the model:

- gender
- birthweight
- birthsize
- agemom
- edumocat: low, middle or high education level of the mother
- age
- D-score

The first five variables are constant over the waves, while the other two variables vary over the waves. For each wave we have estimated two models, *model 1* including all variables as listed above, and *model 2* including all variables except for the D-score. Then, we can compare the explained variation of IQ at 5 years old of both models by comparing the adjusted $R^2$. In this way, we can see how much of the variation in IQ is explained by the D-score for each wave.

```{r, echo=FALSE}
# REGRESSION MODELS (per wave)
smocc.wave1 <- subset(data.long, data.long$wave == 1)
smocc.wave2 <- subset(data.long, data.long$wave == 2)
smocc.wave3 <- subset(data.long, data.long$wave == 3)
smocc.wave4 <- subset(data.long, data.long$wave == 4)
smocc.wave5 <- subset(data.long, data.long$wave == 5)
smocc.wave6 <- subset(data.long, data.long$wave == 6)
smocc.wave7 <- subset(data.long, data.long$wave == 7)
smocc.wave8 <- subset(data.long, data.long$wave == 8)
smocc.wave9 <- subset(data.long, data.long$wave == 9)


# Object to save results
results <- matrix(c(NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA), nrow = 9, ncol = 7)
colnames(results) <- c("Esimate D-score", "95% CI LL", "95% CI UL", "p-value", 
                       "model 1 adj. R2", "model 2 adj. R2", "diff. adj. R2")
rownames(results) <- c("wave 1", "wave 2", "wave 3", "wave 4", "wave 5", "wave 6", 
                       "wave 7", "wave 8", "wave 9")


#In veel waves zijn de haz en waz voor veel kinderen NA.
#Deze wel toevoegen aan het grote model???

# WAVE 1
model.wave1 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave1)
results[1,1] <- coefficients(model.wave1)[5]
results[1,2] <- confint(model.wave1, level = 0.95)[8, 1]
results[1,3] <- confint(model.wave1, level = 0.95)[8, 2]
results[1,4] <- summary(model.wave1)$coefficients[8,4]  
results[1,5] <- summary(model.wave1)$adj.r.squared 
model.wave1.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + agemom, data = smocc.wave1)
results[1,6] <- summary(model.wave1.wd)$adj.r.squared 
results[1,7] <- results[1,5] - results[1,6]

# WAVE 2
model.wave2 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave2)
results[2,1] <- coefficients(model.wave2)[5]
results[2,2] <- confint(model.wave2, level = 0.95)[8, 1]
results[2,3] <- confint(model.wave2, level = 0.95)[8, 2]
results[2,4] <- summary(model.wave2)$coefficients[8,4]  
results[2,5] <- summary(model.wave2)$adj.r.squared
model.wave2.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave2)
results[2,6] <- summary(model.wave2.wd)$adj.r.squared 
results[2,7] <- results[2,5] - results[2,6]

# WAVE 3
model.wave3 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave3)
results[3,1] <- coefficients(model.wave3)[5]
results[3,2] <- confint(model.wave3, level = 0.95)[8, 1]
results[3,3] <- confint(model.wave3, level = 0.95)[8, 2]
results[3,4] <- summary(model.wave3)$coefficients[8,4]  
results[3,5] <- summary(model.wave3)$adj.r.squared
model.wave3.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave3)
results[3,6] <- summary(model.wave3.wd)$adj.r.squared 
results[3,7] <- results[3,5] - results[3,6]

# WAVE 4
model.wave4 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave4)
results[4,1] <- coefficients(model.wave4)[5]
results[4,2] <- confint(model.wave4, level = 0.95)[8, 1]
results[4,3] <- confint(model.wave4, level = 0.95)[8, 2]
results[4,4] <- summary(model.wave4)$coefficients[8,4]  
results[4,5] <- summary(model.wave4)$adj.r.squared
model.wave4.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave4)
results[4,6] <- summary(model.wave4.wd)$adj.r.squared 
results[4,7] <- results[4,5] - results[4,6]

# WAVE 5
model.wave5 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave5)
results[5,1] <- coefficients(model.wave5)[5]
results[5,2] <- confint(model.wave5, level = 0.95)[8, 1]
results[5,3] <- confint(model.wave5, level = 0.95)[8, 2]
results[5,4] <- summary(model.wave5)$coefficients[8,4]  
results[5,5] <- summary(model.wave5)$adj.r.squared
model.wave5.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave5)
results[5,6] <- summary(model.wave5.wd)$adj.r.squared 
results[5,7] <- results[5,5] - results[5,6]

# WAVE 6
model.wave6 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave6)
results[6,1] <- coefficients(model.wave6)[5]
results[6,2] <- confint(model.wave6, level = 0.95)[8, 1]
results[6,3] <- confint(model.wave6, level = 0.95)[8, 2]
results[6,4] <- summary(model.wave6)$coefficients[8,4]  
results[6,5] <- summary(model.wave6)$adj.r.squared 
model.wave6.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave6)
results[6,6] <- summary(model.wave6.wd)$adj.r.squared 
results[6,7] <- results[6,5] - results[6,6]

# WAVE 7
model.wave7 <- lm(IQ ~ factor(male) + age + birthweight + birthsize + haz + waz
                  + factor(edumocat) + dscore + agemom, data = smocc.wave7)
results[7,1] <- coefficients(model.wave7)[5]
results[7,2] <- confint(model.wave7, level = 0.95)[8, 1]
results[7,3] <- confint(model.wave7, level = 0.95)[8, 2]
results[7,4] <- summary(model.wave7)$coefficients[8,4]  
results[7,5] <- summary(model.wave7)$adj.r.squared
model.wave7.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave7)
results[7,6] <- summary(model.wave7.wd)$adj.r.squared 
results[7,7] <- results[7,5] - results[7,6]

# WAVE 8
model.wave8 <- lm(IQ ~ factor(male) + age+ birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave8)
results[8,1] <- coefficients(model.wave8)[5]
results[8,2] <- confint(model.wave8, level = 0.95)[8, 1]
results[8,3] <- confint(model.wave8, level = 0.95)[8, 2]
results[8,4] <- summary(model.wave8)$coefficients[8,4]  
results[8,5] <- summary(model.wave8)$adj.r.squared
model.wave8.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave8)
results[8,6] <- summary(model.wave8.wd)$adj.r.squared 
results[8,7] <- results[8,5] - results[8,6]

# WAVE 9
model.wave9 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave9)
results[9,1] <- coefficients(model.wave9)[5]
results[9,2] <- confint(model.wave9, level = 0.95)[8, 1]
results[9,3] <- confint(model.wave9, level = 0.95)[8, 2]
results[9,4] <- summary(model.wave9)$coefficients[8,4]  
results[9,5] <- summary(model.wave9)$adj.r.squared
model.wave9.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave9)
results[9,6] <- summary(model.wave9.wd)$adj.r.squared 
results[9,7] <- results[9,5] - results[9,6]

#Misschien beter om de DAZ er in te doen?!

```

The estimates for the predictor D-score, and it's 95\% confidence interval are given in table \@ref(tab:tableIQ). Moreover, it contains the p-values for the predictor D-score in *model 1* and the adjusted $R^2$'s for *model 1* and *model 2*. The adjusted $R^2$ determines the explained variation in the outcome measure, in this case IQ at 5 years, while penalizing for the number of predictors in the model. Comparison of the $R^2$ is not feasible, since it will always increase when another predictor is added to the model.

```{r, tableIQ, echo=FALSE}
library(knitr)
kable(results, caption = "Comparison of the models per wave to explain IQ at 5 years by D-score", booktabs = TRUE, digits = 4)
```

From table \@ref(tab:tableIQ) we can see that the D-score does not explain variation in IQ at 5 years for the first 6 waves. In other words, the D-scores until the age of 1 year will not explain the variation in IQ at the age of 5 years. However, for wave 7, at the age of 15 months, the estimate for the D-score is just significant and explains almost 3\% of the variation in IQ at the age of 5 years. There is also an almost significant effect of the D-score on IQ at waves 8 and 9, however this only explains around 0.5\% of the variation in IQ at 5 years.

## Practical implications

## Opportunities and impact of early intervention
