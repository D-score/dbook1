# Three studies {#ch:threestudies}

This chapter compares child development between samples from three
different studies:

* *SMOCC*, a representative sample of Dutch children;

* *POPS*, a cohort of all Dutch preterms in 1983;

* *TOGO*, a set of medical records from preventive health service in Togo.

Each study used the DDI (see Section \@ref(sec:ddi)). This chapter
focuses in comparing the $D$-scores calculated from the study data.

## SMOCC study

```{r smoccfit9, echo = FALSE, warning = FALSE}
library(gseddata)
library(dscore)
library(gridExtra)
data <- get_data(cohort = 53)
items <- get_itemnames(data)
varlist <- list(adm = c("cohort", "subjid", "agedays"), 
                items = items,
                cov = NULL)
model <- dmetric::fit_dmodel(varlist, data, name = "57_0")
```

```{r plotddaz, echo = FALSE}
plot_ddaz <- function(data, x = "agemos", y = "d", z = "daz", 
                      xlab = "Age (in months)", ylab = "D-score", zlab = "DAZ",
                      colour = "black") {
  reference <- dplyr::select(dscore::Dreference, month, SDM2:SDP2) %>%
    filter(month <= 30) %>%
    tidyr::gather(key = centile, value = d,-month)
  polygon <- data.frame(
    x = c(reference$month[reference$centile == "SDM2"],
          rev(reference$month[reference$centile == "SDP2"])),
    y = c(reference$d[reference$centile == "SDM2"],
          rev(reference$d[reference$centile == "SDP2"])))
  
  g1 <-
    ggplot(data, aes_string(x = x, y = y)) +
    theme_light() +
    scale_x_continuous(xlab,
                       limits = c(0, 30),
                       breaks = seq(0, 30, 6)) +
    scale_y_continuous(ylab,
                       limits = c(0, 75),
                       breaks = seq(0, 70, 10)) +
    geom_polygon(mapping = aes(x = x, y = y), 
                 data = polygon, col = "transparent", fill = "grey", alpha = 0.1) + 
    geom_line(mapping = aes(x = month, y = d, group = centile), 
              data = reference, colour = "grey", alpha = 0.3) +
    geom_point(colour = colour, size = 0.5) +
    facet_wrap( ~ cohort, ncol = 1) +
    theme(legend.position = "none")
  g2 <-
    ggplot(data, aes_string(x = x, y = z)) +
    theme_light() +
    scale_x_continuous(xlab,
                       limits = c(0, 30),
                       breaks = seq(0, 30, 6)) +
    scale_y_continuous(zlab,
                       limits = c(-5, 5),
                       breaks = seq(-5, 5, 1)) +
    annotate("rect", xmin = 0, xmax = 30, ymin = -2, ymax = 2, 
             alpha = 0.1, fill = "grey") +
    geom_point(colour = colour, size = 0.5) +
    facet_wrap( ~ cohort, ncol = 1) +
    theme(legend.position = "none")
  gridExtra::grid.arrange(g1, g2, nrow = 2)
}
```

```{r smoccda9, echo = FALSE, fig.cap = '(ref:smoccda9)', fig.height = 12, warning = FALSE}
model$dscore$agemos <- round(model$dscore$agedays / 365.25 * 12, 3)
model$dscore$daz    <- daz(model$dscore$b, x = model$dscore$agedays, 
                           x.unit = "day")
model$dscore$cohort <- "SMOCC"

plot_ddaz(model$dscore, x = "agemos", y = "b", z = "daz", 
          colour = "#FF7F00B3")
```

(ref:smoccda9) Distribution of $D$-score and DAZ by child age in a
cohort of Dutch children aged 0-2 years (Source: SMOCC data, $n$ =
2151, 9 occasions).

Figure \@ref(fig:smoccda9) shows the $D$-score distribution by age in
the SMOCC data. The grey curves represent references calculated from
the SMOCC data. The top figure illustrates that rise of the $D$-score
with age, whereas the bottom figure shows that the DAZ distribution
covers the references well. 

The undercoverage after the age of 24 months is caused by the ceiling
effect. There are also less prominent ceiling effects at the earlier
ages. Without these effect, the references would presumably show some
additional variation.

## POPS study

```{r readpops, echo=FALSE}
# read data
pops_orig <- haven::read_sav("data-raw/data/pops/POPS19groeiSDS2whoTranslatedExtrav2PLUS.sav")

# translate DDI itemnames to lex_gsed
items <- gseddata::rename_gcdg_gsed(paste0("n", 1:57))
names(pops_orig)[44:100] <- items

# adopt gseddata conventions
pops_data <- pops_orig %>% 
  mutate(
    subjid    = as.integer(patid),
    agedays   = as.integer(Age),
    gagebrth  = as.integer(gestationalage * 7)
    ) %>% 
  mutate_at(vars(items), function(x) as.integer(1 - x)) %>% 
  dplyr::select(subjid, agedays,
                gagebrth, 
                dead, handicap,
                items)

# add useful variables
pops_data <- pops_data %>% 
  mutate(
    ageweeks    = trunc(agedays / 7),
    ageweekscat = cut(ageweeks, c(1, 19, 27, 32, 41, 59, 67, 111, 120, 200), right = FALSE),
    agemos      = round(agedays / 365.25 * 12, 3),
    age_c0.00   = (agedays - 0.00 * (280 - gagebrth)) / 365.25,
    age_c0.50   = (agedays - 0.50 * (280 - gagebrth)) / 365.25,
    age_c0.75   = (agedays - 0.75 * (280 - gagebrth)) / 365.25,
    age_c1.00   = (agedays - 1.00 * (280 - gagebrth)) / 365.25)
```

```{r pops2, echo = FALSE, eval = FALSE}
# count nuber of NA's in items
nas <- apply(pops_data[, items], MARGIN = 1, function(x) sum(is.na(x)))

# select rows with at least one DDI-item
#        infants below 32 weeks (224 days) gestational age
#                no dead, no handicaps
pops_pt <- pops_data %>% 
  dplyr::filter(nas < 57) %>% 
  dplyr::filter(gagebrth < 224 & dead == 0 & handicap == 0)

# Data on 258 pre-terms
# length(unique(pops_pt$subjid))
# [1] 258
```

```{r popsd, echo = FALSE}
# determine dscore key
dkey <- data.frame(item = model$itembank$lex_gsed,
                   delta = model$itembank$tau,
                   stringsAsFactors = FALSE)

# calculate D-score under four age-corrections
ref <- dscore::Dreference

pops_data$age <- pops_data$age_c0.00
d_0.00 <- ability(data = pops_data, items = items, key = dkey, qp = -10:80)
z_0.00 <- daz(d = d_0.00$b, x = pops_data$age, ref = ref)

pops_data$age <- pops_data$age_c0.50
d_0.50 <- ability(data = pops_data, items = items, key = dkey, qp = -10:80)
z_0.50 <- daz(d = d_0.50$b, x = pops_data$age, ref = ref)

pops_data$age <- pops_data$age_c0.75
d_0.75 <- ability(data = pops_data, items = items, key = dkey, qp = -10:80)
z_0.75 <- daz(d = d_0.75$b, x = pops_data$age, ref = ref)

pops_data$age <- pops_data$age_c1.00
d_1.00 <- ability(data = pops_data, items = items, key = dkey, qp = -10:80)
z_1.00 <- daz(d = d_1.00$b, x = pops_data$age, ref = ref)

data2 <- bind_cols(pops_data, 
                   cohort  = rep("POPS", nrow(pops_data)),
                   n = d_0.00$n, 
                   p = d_0.00$p,
                   f = d_0.00$n - d_0.00$p,
                   d_0.00 = d_0.00$b,
                   d_0.50 = d_0.50$b,
                   d_0.75 = d_0.75$b,
                   d_1.00 = d_1.00$b,
                   daz_0.00 = z_0.00,
                   daz_0.50 = z_0.50,
                   daz_0.75 = z_0.75,
                   daz_1.00 = z_1.00)
data2 <- data2[!is.na(data2$daz_0.75), ]
```

```{r popsda9, echo = FALSE, fig.cap = '(ref:popsda9)', fig.height = 12, warning = FALSE}
data2$cohort <- "POPS"
data2$agemos <- data2$age_c0.75 * 12
plot_ddaz(data2, y = "d_0.75", z = "daz_0.75", 
          xlab = "Age (in months) corrected", 
          colour = "#006CC2B3")
```

(ref:popsda9) Distribution of $D$-score and DAZ by child age in a
cohort of preterm aged 0-2 years. Ages are corrected for preterm birth
by a factor of 0.75 (Source: POPS data, $n = 450$, 4 occasions).

Figure \@ref(fig:popsda9) presents the $D$-score and DAZ distributions
for the POPS cohort of children born very preterm or with very low
birth weight. All in all, the distributions of the $D$-score and DAZ
are similar to those found in the SMOCC study.

Since the $D$-scores are calculated using the same milestones and
difficulty estimates as used in the SMOCC data, the $D$-scores are
comparable across the two studies. 

The primary new complication here is the question whether it is fair
compare *postnatal age* (or *calender age*) of children born a term
with calender ages of very preterm children. This section focuses on
this issue in some detail.

### POPS design

In 1983, the Project On Preterm and Small for Gestational Age Infants
(POPS study) collected data on all 1338 infants in the Netherlands who
had very preterm birth (gestational age < 32 weeks) or very low birth
weight (birth weight < 1500 grams). See @verloove-vanhorick1986 for
details. 

Gestational age was determined from the best obstetric estimate,
including last menstrual period, results of pregnancy testing, and
ultrasonography findings. The POPS study collected measurements on 450
children using the DDI at four visits at corrected postnatal ages of
3, 6, 12 and 24 months.

### Age-adjustment

Assessment of very preterm children at the same chronological age as
term children may cause over-diagnosis of developmental delay in very
preterm children. Very preterm children may require additional time to
enable development equivalent to that of normal term birth children.

In anthropometry, it is common to correct chronological age of very
preterm born children so as to enable age-appropriate evaluation of
growth. For example, suppose the child is born as a gestational age of
30 weeks, which is 10 weeks early. A *full correction* would deduct 10
weeks from the child's postnatal age, and a *half correction* would
deduct 5 weeks. More in particular, we calculate corrected age (in
days) as:

$$
\mathrm{corrected\ age} = \mathrm{postnatal\ age}\mathrm{\ (days)} - f \times [280 - \mathrm{gestational\ age\ (days)}],
$$

where we specify several alternative for $f$ as 1.00 (full
correction), 0.75, 0.50 (half) or 0.00 (no correction).

Let's apply the same idea to child development. Using *corrected age*
instead of *postnatal age* has two consequences:

* It will affect the prior distribution for calculating the $D$-score;

* It will affect DAZ calculation.

We evaluate these two effects in turn.

### Effect of age-adjustment on the $D$-score

```{r adjustd, echo = FALSE, fig.cap = '(ref:adjustd)'}
g <- ggplot(subset(data2, n > 0), 
            aes(x = d_0.00, y = d_1.00, 
                colour = cut(f, breaks = c(-1, 0, 1, 35),
                             labels = c("0", "1", "2+")))) + 
  coord_fixed() +
  theme_light() +
  geom_abline(slope = 1, intercept = 0, color = "grey") +
  geom_point(size = 1) +
  labs(colour = "Number of fails") +
  xlab("D-score (calender age)") +
  ylab("D-score (full age adjustment)") +
  theme(legend.position = c(0.8, 0.15))
g
```

(ref:adjustd) Scatterplot of two versions of the $D$-score, one
calculated using calender age ($f = 0.00$), the other calculated using full
age-adjustment ($f = 1.00$).

Figure \@ref(fig:adjustd) plots the fully age-adjusted $D$-score
against the unadjusted $D$-score. Any discrepancies result only from
differences in the ages used in the age-dependent prior (c.f. Section
\@ref(sec:adp)).

The effect of age-adjustment on the $D$-score is always in the same
direction, and only sizable for perfect scores, especially for lower
$D$-scores. Discrepancies are tiny for non-perfect scores.

### Effect of no age adjustment ($f = 0.00$) on the DAZ

```{r popsda90, echo = FALSE, fig.cap = '(ref:popsda90)', fig.height = 12, warning = FALSE}
data2$agemos <- data2$age_c0.00 * 12
plot_ddaz(data2, y = "d_0.00", z = "daz_0.00", 
          xlab = "Calender age (in months)", 
          colour = "#006CC2B3")
```

(ref:popsda90) Distribution of $D$-score and DAZ without age correction 
for preterm birth ($f = 0.00$).

Figure \@ref(fig:popsda90) illustrates that a considerable number of
$D$-scores fall below the minus -2 SD line of the reference when age
is not adjusted, especially during the first year of life. The pattern
suggests that the apparent slowness in development is primarily the
result of being born early, and does not necessarily reflect delayed
development.

### Effect of full age adjustment ($f = 1.00$) on the DAZ

```{r popsda91, echo = FALSE, fig.cap = '(ref:popsda91)', fig.height = 12, warning = FALSE}
data2$agemos <- data2$age_c1.00 * 12
plot_ddaz(data2, y = "d_1.00", z = "daz_1.00", 
          xlab = "Age (in months), fully corrected", 
          colour = "#006CC2B3")
```

(ref:popsda91) Distribution of $D$-score and DAZ under full age correction 
for preterm birth ($f = 1.00$).

Full age correction has a major effect on the DAZ. Figure
\@ref(fig:popsda91) illustrates that the POPS children are now
somewhat advanced over the reference children. This may reflect the
effect of longer exposure to sound and vision ex-utero, so developed
in preterms may actually be more advanced than that of term peers. 

Full age correction overcorrects the $D$-score, so it is natural to
try intermediate values for $f$ between 0 and 1.

### Partial age adjustment

```{r tabz, echo = FALSE}
tabs <- data2 %>% 
  mutate(gp = cut_number(agemos, n = 8)) %>% 
  group_by(gp) %>% 
  summarise(z0.00 = mean(daz_0.00, na.rm = TRUE),
            z0.50 = mean(daz_0.50, na.rm = TRUE),
            z0.75 = mean(daz_0.75, na.rm = TRUE),
            z1.00 = mean(daz_1.00, na.rm = TRUE))
kable(tabs, 
      caption = "Average DAZ at various ages under four correction factors.",
      col.names = c("Month", "0.00", "0.50", "0.75", "1.00"))
```

Table \@ref(tab:tabz) compares mean DAZ under various specifications
for $f$. Values $f = 0.00$ and $f = 0.50$ do not correct for preterm
birth enough in the sense that all sign are negative. In contrast, $f
= 1.00$ overcorrects as a value of 0.59 is implausibly high. Setting
$f = 0.75$ seems a good compromise. The average DAZ is close to zero
in the first age interval. The fact that average DAZ is negative at
later ages under $f = 0.75$ may be reflect less than optimal growth
and development of very preterm and low birth weight children.

### Conclusions 

* Compared with the general population, more very preterm children
reached developmental milestones within chronological age 5 months
when chronological age was fully corrected;

* Fewer preterm children reached the milestones when chronological age
was not corrected;

* Fewer children reached the milestones when $f = 0.50$ correction was
used;

* Similar proportions were observed when $f = 0.75$ was used within the first 5 months after birth. 

* After chronological age 5 months, similar proportions were observed between very preterm and full term children when
chronological age was fully corrected. 

* We recommend $f = 0.75$ correction of chronological age.

## TOGO study

### Usability and validity of the $D$-score in a low income country: The case of Togo

The $D$-score is intended as a universal measure of children’s development. There is ample research indicating that the $D$-score actually is a valid indicator of development in western European countries like the Netherlands. If the $D$-score is a universal measure it should be informative in low and middle income countries as well. However, little is known about the usability and validity of the $D$-score in such countries. The aim of the present study is to examine the usability and validity of the $D$-score in the western African country of Togo. Togo definitely qualifies as a low income country with a 2017 GNI per capita of $610 versus $46,180 in the Netherlands, and $744 for low income countries in general (data.worldbank.org).   
	To address this issue, we used data that were gathered by a French physician in Kpalimé, Togo. She set up a child health care system that was modeled after the Dutch preventive health care system. The system included the use of the *Dutch Development Instrument* (DDI; in Dutch: *Van Wiechenschema*) to assess whether children’s developmental progress is in the normal range. The DDI data were used to calculate the $D$-scores as well as the age-corrected z-score of the $D$-score relative to a Dutch sample (DAZ). These two indices are the dependent variables in the present study. Data were gathered from about 9747 individuals in the 0-18 age range, but for the present study we focus on data from children in the 0-4 age range because the DDI assessment system is meant for this age range.  
	Other available measures include father’s level of schooling, father’s number of children at the child’s first visit to the medical center, the APGAR score as a newborn, children’s weight, and the results of a physician’s neurological examination during visits to the health center. These variables are used to predict children’s $D$-scores and thereby to examine the $D$-score’s usability and validity in Togo.  

**Methods**  

*Participants*    
	Participants potentially included 1859 children in the 0-4 age range who paid at least one visit to the Kpalimé health center. Kpalimé is the fourth biggest town in Togo, but the health center also attracted parents and children from a wide surrounding rural area. Parents visited the health center for several reasons, including for a preventive health check or because of their child’s apparent health problems. The possibility of visiting the health center was made known to parents by information sessions for parents at primary schools. Parents paid a small amount of money per visiting child (about €4 for children of 4 years or older, and €0.80 for children younger than 4 years).  
	Because of limitations that are inherent to working in a low income country (limited access to the internet, computer failure) data of newly digitized paper dossiers were sent to the Netherlands on a regular basis, but this practice unavoidably caused some unclarities and inconsistencies in the resulting dataset. Many of these could be solved, but time constraints prevented us from solving them all. Consequently, the data of .. potential participants (..%) were not yet included in the present study which leaves a dataset of 1659 (of 1644 NOG UITZOEKEN). Moreover $D$-scores could not be calculated when either age or DDI data were missing, which leaves a dataset of 2342 visits from 1522 children. The number of visits that parents of these children in the 0-4 age range paid to the health center varied from 1 – 9, but the majority of children were seen only once (n = 1146; 75.3%).  

*Measures*  
$D$-score  
$D$-scores were calculated based on a French-language version of the DDI assessment. As in the Dutch preventive health care system, the goal of administering the DDI assessment was to  distinguish children with developmental problems from normal children. This means that items were chosen such that 90% of the children is expected to pass on age-equivalent items. Generally, for children that did not pass items age-equivalent items, extra items meant for a lower age were assessed (with the exception that items meant for children younger than 15 months were never administered to children of age 15 months or older). Scores were strictly based on observations rather than on parent report. For the exact procedure to calculate $D$-scores based on DDI-scores, see chapter 5.  

Medical assessment  
At each visit a physician notated whether problems were observed regarding a wide range of health aspects including problems with reflexes and muscle tension. Also, weight was measured at each visit.

Background characteristics  
At the first visit of each child, the accompanying adult (mostly the mother) was asked to report on general background characteristics, including profession of the parents and the number of children each of the parents has (due to polygamy this number may differ between parents). As a measure of socio-economic status (SES) we constructed a dichotomous variable 'schooling of father' based on the reported profession of the father. As the main physician and founder of the medical center is familiar with the local culture and schooling system, she indicated which of the thirteen most common professions were likely to be schooled professions (i.e. need more than primary education). Fathers with one of these professions were classified as 'schooled'. When 'another profession' was marked, the father was categorized as unschooled.  
	Other background characteristics included gender of the child, number of children of the father at the moment of the first visit, and birth date. Age of the child at the moment of visiting was calculated based on the date of visit and the birth date. In Togo, medical information about a newborn is notated on a special card which parents receive. Parents were asked to take this card to the medical center; in this way information about the birth situation of part of the children was obtained, including 
	<!-- birth weight, gestational age (<37 weeks versus 37 weeks or more) and  (wordt in beschreven analyses niks mee gedaan gebruikt, dus niet noemen)-->
	APGAR scores at 1, 5 and 10 minutes after birth.  

*Procedure*  
Measures used in this study were assessed at the medical center in Kpalimé which parents visited with their children, and were part of a general preventive health assessment (including physical measurements of weight, height, and head size, a medical examination, a few blood tests, and a hearing test). Also, parents were asked to report on characteristics of the birth situation, previous health issues, nutrition situation, and background characteristics of the family.   
During the visits, medical assessment took place before assessment of the DDI assessment, and was conducted by the same physician. All assessments, including the DDI assessment, were either performed by the initiating physician and founder of the medical center, or by one of three local physicians trained to assess the DDI procedure. Resulting data of the assessment (including advice given and/or references to another professional) were documented in paper dossiers and in 2017 digitized by four local assistants via software program EpiData. 
 
*Analyses*  
To assess the validity of the $D$-score in this population, we inspected scatter plots in which $D$-scores are plotted against age for all available visits, and in which children with neurological problems as observed by a physician are highlighted. It was expected that a curve is seen, with higher $D$-scores for older children, moreover children with very low $D$-scores for their age were expected to be assessed by the physician as having a neurological problem.
	Validity and usability of the $D$-score in this population would also be supported when known risk factors of developmental problems would be found to be predictors of a lower $D$-score in this population as well. Risk factors of interest are health problems of a newborn (as indicated by a less than optimal APGAR score at 10 minutes), and being underweighted. Furthermore, if a relation between underweight and a lower $D$-score is observed, it would also be interesting to see whether there is a relation between family size and $D$-score, as many children per family could be a cause of malnutrition. For this purpose children were classified as being part of a large family when the number of children of their father was 5 or more (at the moment of their first visit) versus 4 or less.  
  To assess which risk factors predict a lower than normal $D$-score, several regression analyses were conducted. Outcome variable is the Development - Age adjusted Z-score (DAZ) which tells how many standard deviations the $D$-score of the child deviates from his/her age mates. To calculate these z-scores, data of Dutch children are used as reference data. As this reference data is only available for children younger than age 2.78 years, only DAZ-scores could be calculated for age group 0 – 2.78, and therefore all regression analyses were performed for this subgroup.  
  For some of the risk factor variables data is only available for part of the children. In order to prevent a loss of power, for each risk factor separate regression analyses were conducted. In each regression sex and education level of father (schooled versus unschooled) were added as covariates (except for the regression where the relation between large families and the DAZ is analyzed, as family size and schooling may be confounded). As data from visits of the same children are not independent, regressions were performed on data with one visit per child only. All regression analyses were conducted twice: once with the data from the first visit of each child, and once with the last visit of each child.


**Results**  

<!-- nog ergens invoegen (in tekst?): n-en van de regressies ## -->

```{r, echo=FALSE}
library(ddata)
library(dscore)

# remove rows without valid agedays
togo <- TGO %>%
  filter(!is.na(agedays)) %>%
  arrange(id, agedays)

# calculate d and daz
itembank_NL <- dscore::itembank[,c("lex_gcdg", "tau")]
# lijkt erop togo ability() standaard de var 'age' gebruikt die in je data voorkomt, ook als je in de functie bij age="" een andere var opgegeven hebt die gebruikt moet worden
# zorg dat age echt age in jaren is: daarom overnemen van age_yr:
togo$age <- togo$age_yr
# calculate d
output_dscore <- ability(data=togo,
                              items = colnames(togo)[colnames(togo)%in%itembank$lex_gcdg],
                              age="age", 
                              metric="dscore",
                              itembank=itembank_NL,
                              lexicon="gcdg")
togo <- cbind(togo, output_dscore)
# b = d-score; rename 'b' as 'd'
colnames(togo)[grep("^b$", colnames(togo))] <- "d"

# calculate daz
ref_NL <- dscore::Dreference # reference group
# with 'x.unit' as 'year' as 'age' is in years
togo$daz <- daz(togo$d, togo$age, x.unit = "year", ref = ref_NL)

# select subset: only visits with d-scores (use in plots to prevent warnings about missing values)
togo_d <- togo[is.na(togo$d)==FALSE,]

# select subset with first daz-measurement per child
togo <- togo[order(togo$id, is.na(togo$daz), togo$agedays),]
togo$firstDAZ <- as.numeric(duplicated(togo$id)==FALSE)
togo_first <- togo[togo$firstDAZ==1,]

# select subset with last daz-measurement per child
togo <- togo[order(togo$id, is.na(togo$daz), -togo$agedays),]
togo$lastDAZ <- as.numeric(duplicated(togo$id)==FALSE)
togo_last <- togo[togo$lastDAZ==1,]


# select subset with first child measurement
# togo_first <- togo %>%
#   group_by(id) %>%
#   mutate(first = min(agedays)) %>%
#   filter(agedays == first)

# select subset with last child measurement (gives less cases as togo_last above as oldest children don't have a daz because no reference data was available above age 2.7)
# togo_last <- togo %>% 
#  group_by(id) %>%
#  mutate(last = max(agedays)) %>%
#  filter(agedays == last)


```


```{r, echo=FALSE}
# the continuous variables:
contvars <- c("age_yr", "d", "daz", "weight", "waz")
# the categorical variables:
catvars <- c("male", "prof_father_dich", "tonus.and.or.reflex.problems", 
             "apgar.10min.dich.less.than.10") # (below: recode 'apgar.10min.dich10')

# for descriptives use child level data: last visit with daz per child
curdat <- togo_last

# construct variable tonus.and.or.reflex.problems
curdat$tonus.and.or.reflex.problems <- NA
curdat$tonus.and.or.reflex.problems[
  is.na(curdat$neuro.reflex) == FALSE & is.na(curdat$neuro.tonus) == FALSE] <- 0
curdat$tonus.and.or.reflex.problems[
  is.na(curdat$neuro.reflex)==FALSE & 
    is.na(curdat$neuro.tonus)==FALSE & 
    (curdat$neuro.reflex==1 | curdat$neuro.tonus==1)] <- 1
# table(curdat$tonus.and.or.reflex.problems, useNA="ifany")
# table(curdat$neuro.tonus,
      # curdat$neuro.reflex, useNA="ifany")

# rescore variable 'apgar.10min.dich10' (to 1='not optimal' and 0='optimal')
curdat$apgar.10min.dich.less.than.10 <- NA
curdat$apgar.10min.dich.less.than.10[curdat$apgar.10min.dich10==1] <- 0
curdat$apgar.10min.dich.less.than.10[curdat$apgar.10min.dich10==0] <- 1
# table(curdat$apgar.10min.dich.less.than.10, curdat$apgar.10min.dich10, useNA="ifany")

# descriptives
# continuous variables:
v_n <- lapply(curdat[contvars], function(x) sum(is.na(x) == FALSE))
v_mean <- lapply(curdat[contvars], mean, na.rm = TRUE)
v_sd <- lapply(curdat[contvars], sd, na.rm=TRUE)
v_median <- lapply(curdat[contvars], median, na.rm=TRUE)
# v_min <- lapply(curdat[contvars], min, na.rm=TRUE)
# v_max <- lapply(curdat[contvars], max, na.rm=TRUE)

descr <- as.data.frame(cbind(v_n, v_mean, v_sd, v_median)) # , v_min, v_max)
descr <- format(descr, digits=2, nsmall=2)
row.names(descr) <- c("age (years)", "D-score","DAZ","weight (kg)", "weight z-score (age-corrected, WHO-reference data)")

knitr::kable(descr, 
             caption="Descriptives (last visit, for which daz could be calculated, per child)",
             col.names=c("N", "mean", "SD", "median"))
```

```{r echo = FALSE}
# voor de categorical vars:
v2_n <- lapply(curdat[catvars], function(x) sum(is.na(x)==FALSE))
v2_perc <- lapply(curdat[catvars], function(x) prop.table(table(x))["1"] * 100) # 

descr2 <- as.data.frame(cbind(v2_n, v2_perc))
descr2 <- format(descr2, digits=1, nsmall=1)
row.names(descr2) <- c("gender (% boys)", "fathers' schooling (% schooled)","muscle tension and/or reflex problems (% with problems, as observed by physician)","APGAR 10 min. (% with score <10)")

knitr::kable(descr2, 
             # caption="Descriptives", 
             col.names=c("N", "%"))


```

The relation between $D$-score and age can be found in figure .. As expected, a curve is seen, with higher ages related to higher $D$-scores. Also, it can be seen that several $D$-scores are below the curve, i.e. these children had lower $D$-scores than their age mates. In figure .. it can be seen that many of these lower than normal $D$-scores are not artifacts of the data, but belong to children that were observed to have reflex and/or muscle tension problems.  

```{r, echo=FALSE}

nvisits_d <- nrow(togo_d)
# of .. unique children:
n_d <- length(unique(togo_d[,"id"]))

library(ggplot2)

# whole group, all visits (i.e. can be more per child)
ggplot() +
  geom_point(data=togo_d,
             aes(x=age_yr*12, 
                 y=d #, colour=no_of_items_completed<4
                 )) +
  scale_x_continuous(name = "age (months)",
                     limits = c(0,65),
                     breaks = seq(0,65, by=10)
                     ) +
  scale_y_continuous(name = "d-score" #,
                     # limits = c(40,80),
                     # breaks = seq(40,80, by=10)
                     ) +
  xlab("age (months)")+ylab("d-score")  + 
  annotate("text", label=paste(nvisits_d, "visits from", n_d, "children", sep=" "), x=55, y=5, fontface="italic")
  # geom_line(data=ref_NL, aes(x=month, y=SDP2), colour="blue") +
  # geom_line(data=ref_NL, aes(x=month, y=SD0), colour="red") +
  # geom_line(data=ref_NL, aes(x=month, y=SDM2), colour="blue")

  

```



```{r, echo=FALSE}
# no. of visits in this plot:
nvisits_tonus_reflex_d <- nrow(togo_d[(is.na(togo_d$neuro.reflex)==FALSE) & (is.na(togo_d$neuro.tonus)==FALSE) & (is.na(togo_d$d)==FALSE),])
# of .. unique children:
n_tonus_reflex_d <- length(unique(togo_d[(is.na(togo_d$neuro.reflex)==FALSE) & (is.na(togo_d$neuro.tonus)==FALSE) & (is.na(togo_d$d)==FALSE),"id"]))

# as validation: 
# red colour for muscle tone and/or reflex-problems
ggplot(togo_d[(is.na(togo_d$neuro.reflex)==FALSE) & (is.na(togo_d$neuro.tonus)==FALSE),], 
       aes(x=age*12, y=d)) +
  geom_point() +
  geom_point(data=togo_d[(is.na(togo_d$neuro.reflex)==FALSE) & (is.na(togo_d$neuro.tonus)==FALSE),],
             aes(x=age*12, y=d, colour=(neuro.reflex==1|neuro.tonus==1) )) +
  scale_x_continuous(name = "age (months)",
                     limits = c(0,65),
                     breaks = seq(0,65, by=10)
  ) +
  scale_y_continuous(name = "d-score" #,
                     # limits = c(40,80),
                     # breaks = seq(40,80, by=10)
  ) +
  xlab("age (months)")+ylab("d-score") +
  scale_color_manual(breaks = c("FALSE", "TRUE"),
                     values=c("black", "red"),
                     labels=c("no reflex or muscle tone problems", "reflex and/or muscle tone problems"),
                     name="as observed by physician:")   + 
  annotate("text", label=paste(nvisits_tonus_reflex_d, "visits from", n_tonus_reflex_d, "children", sep=" "), 
           x=48, y=10,
           # x=-Inf,y=-Inf,
           # hjust=0, vjust=0,
           fontface="italic")

  
```


```{r, echo=FALSE}
# regression
# waz as predictor of daz
# figuur verderop (want na tekst); regressie hier zodat resultaten in tekst gebruikt kunnen worden

# data: last visit with daz, per child
# step 1: gender only (covariate)
regr10.1 <- lm(daz ~ male, data=togo_last) 
# step 2: add fathers' schooling (covariate)
regr10.2 <- lm(daz ~ male + prof_father_dich, data=togo_last)  
# step 3: add predictor of interest: waz
regr10.3 <- lm(daz ~ male + prof_father_dich + waz, data=togo_last)  

regr10.3.summary <- summary(regr10.3)
regr10.3.waz.coeff <- summary(regr10.3)$coefficients["waz",]

```

```{r, echo=FALSE}

# extra analysis relation waz and daz: 
# daz predicted by no. of children in family?
# data: last visit with daz, per child
# step 1: gender only (covariate)
regr6.1 <- lm(daz ~ male, data=togo_last)  
# step 2: add predictor of interest: no.of.children.father (5 or more vs 4 or less)
regr6.2 <- lm(daz ~ male + no.of.children.father.dich5, data=togo_last)  

regr6.2.summary <- summary(regr6.2)
regr6.2.no_of_children_father_dich5.coeff <- summary(regr6.2)$coefficients["no.of.children.father.dich5",]

```

In figure .. underweighted children are highlighted. Visually there seems to be a relation between being underweighted and having a lower than normal $D$-score. A regression based on data of children's last visit for which the DAZ-score could be calculated, showed that indeed the age-corrected weight z-score (waz), after correction for fathers' schooling and sex of the child, did predict the DAZ: a decrease of 1 SD in age-corrected weight was related to a decrease of `r round(regr10.3.waz.coeff["Estimate"],1) ` SD in age-corrected $D$-score (p `r format.pval(regr10.3.waz.coeff["Pr(>|t|)"], eps = .001) `), which is a reasonable effect. The overall model explained `r round(regr10.3.summary$adj.r.squared * 100,0)`% of the DAZ variance (adjusted R^2^). As in the other regression analyses sex and fathers' schooling did not contribute significantly to the model.
	Because there clearly seems to be a relation between underweight and a lower than normal $D$-score, it was also tested whether family size (which might be a cause of malnutrition) did predict the DAZ. No such relation was found: children from large families (5 or more children of the father at the moment of the first visit versus 4 or less children) did not have different DAZ-scores at their last visit than children from smaller families (after correction for sex: B = `r round(regr6.2.no_of_children_father_dich5.coeff["Estimate"],2)`, p = `r format.pval(regr6.2.no_of_children_father_dich5.coeff["Pr(>|t|)"], eps = .001, digits=2)`, adjusted R^2^ = `r round(regr6.2.summary$adj.r.squared,3)`).  
<!-- NOG CHECKEN: is het inderdaad 2zijdig getoetst? -->

```{r, echo=FALSE}
# aantal bezoeken in deze plot:
nvisits_waz_d <- nrow(togo_d[(is.na(togo_d$waz)==FALSE) & (is.na(togo_d$d)==FALSE),])
# van .. unieke kinderen:
n_waz_d <- length(unique(togo_d[(is.na(togo_d$waz)==FALSE) & (is.na(togo_d$d)==FALSE),"id"])) 

# in red: waz < (-2) (weight age-corrected z-score) 
ggplot() +
  geom_point(data=togo_d[is.na(togo_d$waz)==FALSE,],
             aes(x=age*12, 
                 y=d, 
                 colour=waz<(-2)
             )
  ) +
  scale_x_continuous(name = "age (months)",
                     limits = c(0,65),
                     breaks = seq(0,65, by=10)
  ) +
  scale_y_continuous(name = "d-score" #,
                     # limits = c(40,80),
                     # breaks = seq(40,80, by=10)
  ) +
  xlab("age (months)") + ylab("d-score") +
  scale_color_manual(breaks = c("FALSE", "TRUE"),
                     values=c("black", "red"),
                     labels=c("not underweighted (age-corrected zscore > -2)", 
                              "underweighted (age-corrected zscore < -2)"),
                     name="based on WHO reference data:")    + 
  annotate("text", label=paste(nvisits_waz_d, "visits from", n_waz_d, "children", sep=" "), 
           x=45, y=5,
           fontface="italic")


```
<!-- *`r nvisits_waz_d` visits from `r n_waz_d` children* -->




```{r, echo=FALSE}
# regression APGAR as predictor of daz
# figuur verderop (want na tekst); regressie hier zodat resultaten in tekst gebruikt kunnen worden

# data: last visit with daz, per child
# step 1: gender only (covariate)
regr2.1 <- lm(daz ~ male, data=togo_last)
# step 2: add fathers' schooling (covariate)
regr2.2 <- lm(daz ~ male + prof_father_dich, data=togo_last)
# step 3: add predictor of interest: apgar
regr2.3 <- lm(daz ~ male + prof_father_dich + apgar.10min.dich10, data=togo_last)

regr2.3.summary <- summary(regr2.3)
regr2.3.APGAR10min_dich10.coeff <- summary(regr2.3)$coefficients["apgar.10min.dich10",]

```

In figure .. $D$-scores of the children for who a 10-minute APGAR score was available are shown. A less than optimal 10-minute APGAR score (i.e. less than 10 points) did predict a lower DAZ at their last visit after correction for sex and father's schooling (B = `r format(round(regr2.3.APGAR10min_dich10.coeff["Estimate"],2), nsmall=2)`, p `r format.pval(regr2.3.APGAR10min_dich10.coeff["Pr(>|t|)"], eps = .001, digits=2)`, adjusted R^2^ = `r round(regr2.3.summary$adj.r.squared,3)`). So, children with a less than optimal APGAR score at ten minutes after birth, had somewhat lower $D$-scores.  
<!-- NOG CHECKEN: waarom is df zoveel kleiner dan 534? Komt dat door 'laatste visit'-selectie?   -->
<!-- en bij deze nog prematuriteit en evt. geb.gew toevoegen als covariaat? Kan dat dit vooral gaat over prematuur vs niet-prematuur # -->

For all regression analyses mentioned, results were similar when based on children's first visit.

```{r, echo=FALSE}
# no. of visits in plot:
nvisits_apgar10_d <- nrow(togo_d[(is.na(togo_d$apgar.10min)==FALSE) & (is.na(togo_d$d)==FALSE),])
# of .. unique children:
n_apgar10_d <- length(unique(togo_d[(is.na(togo_d$apgar.10min)==FALSE) & (is.na(togo_d$d)==FALSE),"id"]))    

# in red: apgar score below 10, 10min after birth
ggplot() +
  geom_point(data=togo_d[is.na(togo_d$apgar.10min)==FALSE,],
             aes(x=age*12, 
                 y=d, 
                 colour=apgar.10min<10
             )
  ) +
  scale_x_continuous(name = "age (months)",
                     limits = c(0,65),
                     breaks = seq(0,65, by=10)
  ) +
  scale_y_continuous(name = "d-score" #,
                     # limits = c(40,80),
                     # breaks = seq(40,80, by=10)
  ) +
  xlab("age (months)") + ylab("d-score")+
  scale_color_manual(breaks = c("FALSE", "TRUE"),
                     values=c("black", "red"),
                     labels=c("10 points at apgar 10 min",
                              "less than 10 points at apgar 10 min"),
                     name="")    + 
  annotate("text", label=paste(nvisits_apgar10_d, "visits from", n_apgar10_d, "children", sep=" "), 
           x=50, y=10,
           fontface="italic")


```  
 <!-- *`r nvisits_apgar10_d` visits from `r n_apgar10_d` children*  -->

 

**Discussion and conclusions**  

In this study we examined the validity and usability of the $D$-score in low income country Togo. The $D$-score does seem to be informative in this country. The $D$-score did increase with age, and for the majority of the children $D$-scores were very similar within their age group. It is notable that there were also several children with much lower $D$-scores when compared with their age mates. This does not seem to be an artifact of the data or of the measures, as the majority of these children were observed to have muscle tension and/or reflex problems. So, it is plausible that these children indeed had developmental problems. Furthermore, health factors that were expected to be related to having a lower $D$-score were found to be significant predictors: a less than optimal APGAR score 10 minutes after birth, and a lower than normal weight at the time of the assessment were related to a lower than normal $D$-score. Especially the relation between weight and $D$-score was quite strong, as the model with age-corrected weight, sex and father's schooling explained 18% of the variance in age-corrected $D$-score. The positive relation between weight and $D$-score, as well as the fact that children were often underweighted in this population, seems to indicate that being underweighted is a risk factor for developmental problems. The main physician of the medical center noted that not many children with extreme underweight were seen, but our results do indicate that also less than severe underweight does have a negative impact on the development of children.  
	The idea that having many children in the family would be related to having a lower $D$-score (due to possible malnutrition), was not supported. This might mean that there is no clear relation between living in a large family and being underweighted, or that we did not have enough power to detect this, as there were not that many children from large families.  
Neither sex nor father's schooling did significantly contribute to variance in age-corrected $D$-scores. For sex at this young ages, this is consistent with results found in other studies (… refs…). Parents' schooling has been found to be related to $D$-scores in other studies (… refs..); that it was not in the present study might have to do with the population, or with the current method where it was estimated whether the parent was schooled based on profession. Many fathers had a profession other than the thirteen most common professions and were estimated to have no schooling, which might not be correct for part of this group.  
	A limitation of the present study is that our sample might not be representative of children in a low income country, or even of children in Togo. Especially the fact that many children came to the medical center because they were ill might mean that they are not representative in terms of general development and other measures. However, the current goal was to examine the validity and usability of the $D$-score in a low income country, and the result that, even though many children were ill, the $D$-score is clearly related to neurological problems (as indicated by reflex, and/or muscle tension problems), age, APGAR score as a newborn and weight does show that the $D$-score is informative in a low income country as well.  

  
  
  
<!-- Evt nog doen:   -->
<!-- -	Na overleg met Cécile Schat: zij zagen heel weinig echte ondervoeding; wel is lichaamsbouw daar zeer tenger; wat gebeurt er als je ipv ondergewicht 'voedingstoestand geobserveerd door arts' neemt als predictor? Betere indicator van ondervoeding is bovendien: specifieke vorm van bloedarmoede; die variabele zit er ook in; zegt ook iets over eenzijdig eten in plaats van simpelweg te weinig (volgens Cécile Schat komt eenzijdig wel veel voor; te weinig niet)   -->
<!-- -	Gestational age en gebgewicht variabelen naar juiste dataset overhevelen zodat die ook gebruikt kunnen worden (GEDAAN; gebruiken om te laten zien dat verband APGAR-score niet verklaard wordt door prematuriteit?) -->



## Comparison


```{r, echo=FALSE}

# base reference lines on:
ref_NL <- dscore::Dreference # dutch reference group

# togo, whole group, all visits (can be more per child)
ggplot() +
  geom_point(data=togo_d,
             aes(x=age*12, # age in months
                 y=d)) +
  scale_x_continuous(name = "age (months)",
                     limits = c(0,65),
                     breaks = seq(0,65, by=10)
                     ) +
  scale_y_continuous(name = "d-score" #,
                     # limits = c(40,80),
                     # breaks = seq(40,80, by=10)
                     ) +
  xlab("age (months)")+ylab("d-score") +
   geom_line(data=ref_NL, aes(x=month, y=SDP2), colour="blue", size=1.5) +
   geom_line(data=ref_NL, aes(x=month, y=SD0), colour="red", size=1.5) +
   geom_line(data=ref_NL, aes(x=month, y=SDM2), colour="blue", size=1.5)
```
