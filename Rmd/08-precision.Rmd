# Precision {#ch:precision}

The chapter shows the properties of the $D$-score when calculated from
short tests. The study of short tests is useful because it reveals the
behavior of the $D$-score when the measurement is inherently imprecise.

* SMOCC milestone subsets (\@ref(sec:smoccmilestones))

* Comparing two $D$-scores from milestone subsets (\@ref(sec:comparingd))

* Impact of short tests on predicting IQ (\@ref(sec:predictiq))

## SMOCC design: standard and additional milestones {#sec:smoccmilestones}

At each visit the SMOCC study collected scores on a set of *standard
milestones* (that about 90 percent of the children will pass) and a
set of *additional milestones* (that about 50 percent of the children
will pass). See Section \@ref(sec:smocc).

The SMOCC dataset covers nine different *waves* (occasions, visits).
The set of milestones used in the DDI varies per wave. The number of
standard milestones varies between 2 and 7 at the various waves. The
additional milestones are the milestones for the next wave.

```{r, echo=FALSE}
w1 <- c(1, 5, 2)
w2 <- c(2, 2, 5)
w3 <- c(3, 5, 6)
w4 <- c(6, 6, 7)
w5 <- c(9, 7, 6)
w6 <- c(12, 6, 6)
w7 <- c(15, 6, 6)
w8 <- c(18, 6, 6)
w9 <- c(24, 6, 6)
tableSMOCC <- rbind(w1, w2, w3, w4, w5, w6, w7, w8, w9)
colnames(tableSMOCC) <- c("Age in months", "Standard milestones", "Additional milestones")
rownames(tableSMOCC) <- c("wave 1", "wave 2", "wave 3", "wave 4",
                          "wave 5", "wave 6", "wave 7", "wave 8",
                          "wave 9")
```

```{r tableSMOCC, echo=FALSE}
## 
kable(tableSMOCC, caption = "Overview of the nine waves of the SMOCC data", booktabs = TRUE)
```

Table \@ref(tab:tableSMOCC) summarizes the schedules age for each
wave, the number of standard milestones and the number of additional
milestones.

In the analyses done thus far we have calculated $D$-scores from
responses on the combined (standard plus additional) milestones. So,
for wave 2, we calculated the $D$-score from 2 (standard) + 5
(additional) = 7 milestones. 

In daily routine, the set of additional milestones often lacks. This
chapter explores the impact of using the (smaller) subset of standard
milestones on measurement error and prediction.

## Comparing $D$-scores calculated from different milestones {#sec:comparingd}

In this section, we calculate the $D$-score from the standard and
additional milestones separately. This is a more difficult task,
especially in the case of the 2-month standard set, which has only
very easy milestones. There is thus very little information to inform
the $D$-score.

```{r init08, echo=FALSE, message=FALSE, warning = FALSE}
library(gridExtra)
library(dplyr)
# data.long <- haven::read_sav("//365tno.sharepoint.com@SSL/DavWWWRoot/teams/P060.33452/TeamDocuments/Team/Work/Booklets/Data/smocc_long3.sav")
data.long <- haven::read_sav("data-raw/data/smocc/smocc_long3.sav")
data.long$scores_false <- data.long$scores_false - 1
data.long$scores_false_nw <- data.long$scores_false_nw - 1
data.long <- as_tibble(data.long)

data.long$wave <- factor(data.long$wave)
data.long1 <- data.long[!is.na(data.long$IQ), ]
data.long1 <- data.long1[!is.na(data.long1$dscore), ]
data.long1$scores_false <- as.factor(data.long1$scores_false) 
data.long1$scores_false_nw <- as.factor(data.long1$scores_false_nw) 
```

```{r calcmonth23d, cache = FALSE, echo=FALSE, message=FALSE, warning = FALSE}
library(ggplot2)
library(ggpubr)
theme_set(theme_light())
set.seed(33311)

xlim <- c(10, 40)
data.long1$IQ <- rnorm(n = nrow(data.long1), mean = 100, sd = 15)
p2 <- ggplot()+
  geom_point(data=subset(data.long1, wave == c(2)), aes(dscore, IQ, group = wave, col=scores_false), show.legend=F, size = 1)+ 
  scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40"))+
  coord_cartesian(xlim=xlim) +
  scale_x_continuous(name = "D-score (standard milestones) ") +
  facet_grid(. ~ wave) +
  geom_density(data=subset(data.long1, wave == c(2)),   
               aes(dscore, y = ..density..*100),
               show.legend = F) +
  theme(legend.position = "none", axis.text.y = element_blank()) + 
    ylab("") +
  scale_y_continuous(sec.axis = sec_axis(~./100, name = "Density D-score"))

p3 <- ggplot()+
  geom_point(data=subset(data.long1, wave == c(3)), aes(dscore, IQ, group = wave, col=scores_false), show.legend=F, size = 1)+ 
  scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40"))+
  coord_cartesian(xlim=xlim) +
  scale_x_continuous(name = "D-score (standard milestones) ") +
  facet_grid(. ~ wave) +
  geom_density(data=subset(data.long1, wave == c(3)),   
               aes(dscore, y = ..density..*100),
               show.legend = F) +
  theme(legend.position = "none", axis.text.y = element_blank()) + 
    ylab("") +
  scale_y_continuous(sec.axis = sec_axis(~./100, name = "Density D-score"))
  
# D-score next wave
p2.nw <- ggplot() +
  geom_point(data=subset(data.long1, wave == c(2)), aes(dscore.nw, IQ, group = wave, col=scores_false_nw), show.legend=T, size = 1)+ 
  scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40"), 
                      name = "Number of fails")+
  coord_cartesian(xlim=xlim) +
  scale_x_continuous(name = "D-score (additional milestones) ") +
  facet_grid(. ~ wave) +
  geom_density(data=subset(data.long1, wave == c(2)),   
               aes(dscore.nw, y = ..density..*100),
               show.legend = F) +
  theme(axis.text.y = element_blank()) + 
  ylab("") +
  scale_y_continuous(sec.axis = sec_axis(~./100, name = "Density D-score"))

p3.nw <- ggplot()+
  geom_point(data=subset(data.long1, wave == c(3)), aes(dscore.nw, IQ, group = wave, col=scores_false_nw), show.legend=T, size = 1)+ 
  scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40"), 
                      name = "Number of fails")+
  coord_cartesian(xlim=xlim) +
  scale_x_continuous(name = "D-score (additional milestones) ") +
  facet_grid(. ~ wave) +
  geom_density(data=subset(data.long1, wave == c(3)),   
               aes(dscore.nw, y = ..density..*100),
               show.legend = F) + 
  theme(axis.text.y = element_blank()) + 
    ylab("") +
  scale_y_continuous(sec.axis = sec_axis(~./100, name = "Density D-score"))
```

```{r month2d, echo = FALSE, cache = FALSE, message=FALSE, warning=FALSE, fig.height = 4, fig.cap='(ref:month2d)'}
ggarrange(p2, p2.nw, ncol=2, nrow=1, common.legend = TRUE, legend="bottom")
```

(ref:month2d) Distribution of the $D$-scores calculated from the
standard (left) and additional (right) milestones at month 2. Colors
correspond to sum scores.

The horizontal axis of Figure \@ref(fig:month2d) shows the $D$-score,
separately calculated from the standard and additional milestones for
month 2. The vertical axis is a random normal variate that jitters the
points. It is unrelated to the $D$-score, and carries no further
meaning. The densities located at the bottom show the distribution of
the values of the $D$-score. The colours of the dots in the figure
vary with the number of FAIL scores. The number of milestones differs
per wave.

At month 2 there are two standard milestones. About 90 percent of the
infants will pass these. The five additional milestones are the
standard milestones from month 3. At month 2 infants have
approximately a 50 percent chance of passing. There is some variation
in $D$-scores with the same number of fails, which is caused by
differences in age. As explained in Section \@ref(sec:adp), remember
that the $D$-score is calculated by using an age-dependent prior. If
the ages vary (and they do), then the $D$-score for infants having the
same total score will also vary.

The left-hand figure shows a substantial *gap* between the green dots
(perfect score) and the yellow dots (one FAIL). Since 90\% of the
children should be able to pass each milestone, the impact of a FAIL
on the $D$-dcore is substantial. For example, the $D$-score of an
infant with one FAIL on a standard milestone drops from about 20$D$ to
14$D$. Thus, with these two milestones there cannot be any $D$-score
in the range 15$D$ - 18$D$. It depends on the purposes of the
measurement whether this is acceptable. We can prevent such gaps by
measuring more milestones, e.g., milestones taken from the additional
set.

Note that the range of the estimated $D$-score is quite similar in
both plots. This is because $D$-score estimation takes the difficulty
level of the milestones into account. The estimate of the $D$-score is
*unbiased* for difficulty.

```{r month3d, echo = FALSE, cache=FALSE, message=FALSE, warning=FALSE, fig.height = 4, fig.cap='(ref:month3d)'}
ggarrange(p3, p3.nw, ncol=2, nrow=1, common.legend = TRUE, legend="bottom")
```

(ref:month3d) Distribution of the $D$-scores calculated from the
standard (left) and additional (right) milestones at month 3.

Figure \@ref(fig:month3d) is the same plot as before, but now for
month 3. Compared to Figure \@ref(fig:month2d) all points have shifted
to the right, because the children are now one month older. The
additional milestones from month 2 are the standard milestones of
month 3. In Figure \@ref(fig:month2d) eight children (in purple)
failed all five additional milestones. One month later, there is no
child that failed more than three times.

```{r d23comp, eval = FALSE, echo = FALSE, message=FALSE, warning=FALSE, fig.height = 4, fig.cap='(ref:d23comp)'}
ggplot(data.long1, aes(x = dscore, y = dscore.nw, group = scores_false)) + 
  coord_fixed(ratio = 1) +
  geom_abline(col = "grey") + 
  geom_point()
ggarrange(p3, p3.nw, ncol=2, nrow=1, common.legend = TRUE, legend="bottom")
```

(ref:d23comp) Distribution of the $D$-scores calculated from the
standard (left) and additional (right) milestones at month 3.


```{r}

```


```{r, eval=FALSE, echo=FALSE, warning=FALSE, message=FALSE}
#D-scores plot
p.dscore <- ggplot(data.long1, aes(age, dscore, group = wave)) +
  geom_point(aes(col=scores_false), show.legend=F, size = 1 )+ 
  scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40"))+
  coord_cartesian(xlim=c(0, 25)) +
  scale_y_continuous(name = "D") +
  scale_x_continuous(name = "age") 
p.dscore

p.dscore.nw <- ggplot(data.long1, aes(age, dscore.nw, group = wave)) +
  geom_point(aes(col=scores_false_nw), show.legend=F, size = 1 )+ 
  scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40"))+
  coord_cartesian(xlim=c(0, 25)) +
  scale_y_continuous(name = "D") +
  scale_x_continuous(name = "age") 
p.dscore.nw

resultsSMOCC <- data.frame(a = c("Area of Residence","rural", "semi-urban" , "urban", "metropolitan", "Maternal education (in years)", "Paternal education (in years)", "Maternal age (in years)", "Gestational age (in weeks)", "Gestational age (in categories)", "$\\geq 37$ weeks", "$\\geq 32 - 37$ weeks", "$<32$ weeks*", "Gender", "boys", "girls", "Birthweight (in kg)","Birthweight (in categories)", "$\\geq 2500$ grams", "$\\geq 1500 - <2500$ grams", "$<1500$ grams", "Birth size (in cm)", "Apgar score after 1 min", "$<5$", "$\\geq 5$", "Apgar score after 5 min", "$<7$", "$\\geq 7$"), 
                b = c(" ","$15$", "$1257$" , "$294$", "$0$", "$1559$", "$1555$", "$1577$", "$1578$", " ", "$1495$", "$78$", "$5$", " ", "$768", "$810$", "$1578$"," ", "$1485$", "$85$", "$8$", "$1381$", " ", "$28$", "$1304$", " ", "$15$", "$1336$"),
                c = c( " ","$1.0%$", "$80.3%$" , "$18.8%$", "$0.0%$", "$13 (2.3)$", "$14 (2.6)$", "$30 (4.5)$", "$40 (1.8)$", " ", "$94.7%$", "$4.9%$", "$0.3%$", " ", "$48.7%$", "$51.3%$", "$3.419 (0.559)$"," ", "$94.1%$", "$5.4%$", "$0.5%$", "$51 (2.6)$", " ", "$2.1%$", "$97.8%$", " ", "$1.1%$", "$98.9%$"),
                d = c(" ","$0.2842 (0.2469)$", "$0$", "$0.0723 (0.0616)$", " ", "$0.0805 (0.0103)$", "$0.0546 (0.0092)$", "$0.0007 (0.0054)$", "$0.0675 (0.0130)$", " ", "$0$", "$-0.3786 (0.1098)$","$-1.2844 (0.4236)$", " ", "$-0.2896 (0.0474)$", "$0$", "$0.1234 (0.0427)$"," ", "$0$", "$-0.2454 (0.1057)$", "$-0.9537 (0.3361)$", "$0.0163 (0.0097)$", " ", "$0.0493 (0.178)$", "$0$", " ", "$0.1493 (0.2422)$", "$0$"),
                e = c(" ","$1.15$", " " , "$1.17$", " ", "$7.84$", "$5.91$", "$0.13$", "$5.18$", " ", " ", "$-3.45$", "$-3.03$", " ", "$-6.11$", " ", "$2.89$"," ", " ", "$-2.32$", "$-2.84$", "$1.68$", " ", "$0.28$", " ", " ", "$0.62$", " "),
               f = c(" ","$0.25$", " " , "$0.24$", " ", "$<.001$", "$<.001$", "$0.90$", "$<.001$", " ", " ", "$<.001$", "$0.002$", " ", "$<.001$", " ", "$0.004$"," ", " ", "$0.0204$", "$0.0046$", "$0.093$", " ", "$0.78$", " ", " ", "$0.54$", " "))
```

```{r, eval=FALSE, echo=FALSE, warning=FALSE, message=FALSE}
#D-scores plot
p.dscore <- ggplot(data.long1, aes(age, dscore, group = wave)) +
  geom_point(aes(col=scores_false), show.legend=F, size = 1 )+ 
  scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40"))+
  coord_cartesian(xlim=c(0, 25)) +
  scale_y_continuous(name = "D") +
  scale_x_continuous(name = "age") 
p.dscore

p.dscore.nw <- ggplot(data.long1, aes(age, dscore.nw, group = wave)) +
  geom_point(aes(col=scores_false_nw), show.legend=F, size = 1 )+ 
  scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40"))+
  coord_cartesian(xlim=c(0, 25)) +
  scale_y_continuous(name = "D") +
  scale_x_continuous(name = "age") 
p.dscore.nw
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(ddata)
library(dscore)
library(haven)
library(dplyr)
library(tibble)
library(lme4)
library(MASS)
library(ggplot2)
library(gridExtra)
library(ggpubr)
```

## Impact of short tests on predicting IQ {#sec:predictiq}

First, we will plot the D-scores against IQ at 5 years for each of the waves (see figure \@ref(fig:dscoresIQ5yrs)). In this way, we can see the variation in D-scores for the different waves and how this relates to IQ at the age of 5 years. The colours indicate the number of milestones that got a negative score. Thus, for example, yellow indicates that one of the milestones got a negative score, however this does not mean that all yellow dots in the same plot represent the same number of positive scores. It could be that for some children not all scores of the milestones were available. The same holds, ofcourse, for the other colours as well.

```{r, echo = FALSE}
#Subset van de data zonder de losse scores op de items:
# data.long <- haven::read_sav("//365tno.sharepoint.com@SSL/DavWWWRoot/teams/P060.33452/TeamDocuments/Team/Work/Booklets/Data/smocc_long2.sav")
data.long <- haven::read_sav("data-raw/data/smocc/smocc_long2.sav")
data.long$scores_false <- data.long$scores_false - 1
data.long <- as_tibble(data.long)
# data.wide <- haven::read_sav("//365tno.sharepoint.com@SSL/DavWWWRoot/teams/P060.33452/TeamDocuments/Team/Work/Booklets/Data/smocc_wide.sav")
data.wide <- haven::read_sav("data-raw/data/smocc/smocc_wide.sav")

data.wide <- as_tibble(data.wide)


library(gridExtra)
data.long$wave <- factor(data.long$wave)
data.long1 <- data.long[!is.na(data.long$IQ), ]
data.long1 <- data.long1[!is.na(data.long1$dscore), ]
data.long1$scores_false <- as.factor(data.long1$scores_false) 


```




```{r, dscoresIQ5yrs, echo = FALSE,  fig.cap="\\label{fig:dscoresIQ5yrs} The D-scores plotted against IQ at 5 years for each wave", message=FALSE, warning=FALSE}
p1 <- ggplot(subset(data.long1, wave == c(1)), aes(dscore, IQ, group = wave)) +
      geom_point(aes(col=scores_false), show.legend=F, size = 1 )+ 
      scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40"))+
      coord_cartesian(xlim=c(0, 75)) +
      scale_y_continuous(name = "IQ at 5 years") +
      scale_x_continuous(name = "D-score") +
      facet_grid(. ~ wave) 

p2 <- ggplot(subset(data.long1, wave == c(2)), aes(dscore, IQ, group = wave)) +
      geom_point(aes(col=scores_false), show.legend=F, size = 1 )+ 
      scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40"))+
      coord_cartesian(xlim=c(0, 75)) +
      scale_y_continuous(name = "IQ at 5 years") +
      scale_x_continuous(name = "D-score") +
      facet_grid(. ~ wave) 

p3 <- ggplot(subset(data.long1, wave == c(3)), aes(dscore, IQ, group = wave)) +
      geom_point(aes(col=scores_false), show.legend=F, size = 1 )+ 
      scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40")) +
      coord_cartesian(xlim=c(0, 75)) +
      scale_y_continuous(name = "IQ at 5 years") +
      scale_x_continuous(name = "D-score") +
      facet_grid(. ~ wave) 

p4 <- ggplot(subset(data.long1, wave == c(4)), aes(dscore, IQ, group = wave)) +
      geom_point(aes(col=scores_false), show.legend=F, size = 1 )+ 
      scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40")) +
      coord_cartesian(xlim=c(0, 75)) +
      scale_y_continuous(name = "IQ at 5 years") +
      scale_x_continuous(name = "D-score") +
      facet_grid(. ~ wave) 

p5 <- ggplot(subset(data.long1, wave == c(5)), aes(dscore, IQ, group = wave)) +
      geom_point(aes(col=scores_false), show.legend=F, size = 1 )+ 
      scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40")) +
      coord_cartesian(xlim=c(0, 75)) +
      scale_y_continuous(name = "IQ at 5 years") +
      scale_x_continuous(name = "D-score") +
      facet_grid(. ~ wave) 

p6 <- ggplot(subset(data.long1, wave == c(6)), aes(dscore, IQ, group = wave)) +
      geom_point(aes(col=scores_false), show.legend=F, size = 1 )+ 
      scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40")) +
      coord_cartesian(xlim=c(0, 75)) +
      scale_y_continuous(name = "IQ at 5 years") +
      scale_x_continuous(name = "D-score") +
      facet_grid(. ~ wave) 

p7 <- ggplot(subset(data.long1, wave == c(7)), aes(dscore, IQ, group = wave)) +
      geom_point(aes(col=scores_false), show.legend=F, size = 1 )+ 
      scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40")) +
      coord_cartesian(xlim=c(0, 75)) +
      scale_y_continuous(name = "IQ at 5 years") +
      scale_x_continuous(name = "D-score") +
      facet_grid(. ~ wave) 

p8 <- ggplot(subset(data.long1, wave == c(8)), aes(dscore, IQ, group = wave)) +
      geom_point(aes(col=scores_false), show.legend=T, size = 1 )+ 
      scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40")) +
      coord_cartesian(xlim=c(0, 75)) +
      scale_y_continuous(name = "IQ at 5 years") +
      scale_x_continuous(name = "D-score") +
      facet_grid(. ~ wave) 

p9 <- ggplot(subset(data.long1, wave == c(9)), aes(dscore, IQ, group = wave)) +
      geom_point(aes(col=scores_false), show.legend=F, size = 1)+ 
      scale_colour_manual(values = c("0" = "springgreen3", "1" = "gold2", "2" = "darkorange2", "3" = "red3", "4" = "deeppink3", "5" = "purple3","6" = "steelblue4", "7" = "grey40")) +
      coord_cartesian(xlim=c(0, 75)) +
      scale_y_continuous(name = "IQ at 5 years") +
      scale_x_continuous(name = "D-score") +
      facet_grid(. ~ wave) 

#grid.arrange(p1, p2, p3, p4, p5, p6, p7, p8, p9, nrow=3)
library(ggpubr)
ggarrange(p1, p2, p3, p4, p5, p6, p7, p8, p9, ncol=3, nrow=3,
          common.legend = TRUE, legend="bottom")

```
In addition, it is important to note that the number of milestones per wave differ. For example, when we compare the plots for wave 8 and wave 9, it seems that at wave 8 the milestones are more difficult, since there are children who got a negative score on more than one milestone. While at wave 9, the maximum number of milestones with a negative score is one (yellow dots). However, wave 8 contains six milestones of the DDI, while wave 9 only contains one milestone of the DDI. Hence, the difference between the number of milestones at each wave causes the variation in the number of colours used between the nine plots. 

Furthermore, we can see that there is a gap between the cloud of blue dots and the cloud of yellow dots in all nine plots. Or in other words, there is a substantial difference in D-score between children without negative scores and childeren with (at least) one negative score on the milestone(s) of the DDI. The rational behind this, was explained in Chapter 8. 
For most of the waves there is no clear relation between the D-score and IQ at 5 years visible in the plots. However, for wave 7 and 9, we can see that the cloud of blue dots (with higher D-scores) lies a bit higher than the cloud consisting of the other dots. This could indicate that children with an higher D-score at the age of 15 months and 24 months also have an higher IQ at the age of 5 years on average.

Besides the graphical exploration of the relation between the D-score and IQ at 5 years old, we can also use models to determine this relationship. For example, we can model IQ at 5 years old for each wave separately, which allows us to compare the effect of the D-score at each wave on the variation in IQ at 5 years. First, we can estimate models in which the D-score is the only explanatory variable for the variation in IQ at 5 years. The estimate for the D-score and the $R^2$ of these nine models are visualized in figure \@ref(fig:graphestR2).

```{r, echo=FALSE}
# REGRESSION MODELS (per wave)
smocc.wave1 <- subset(data.long, data.long$wave == 1)
smocc.wave2 <- subset(data.long, data.long$wave == 2)
smocc.wave3 <- subset(data.long, data.long$wave == 3)
smocc.wave4 <- subset(data.long, data.long$wave == 4)
smocc.wave5 <- subset(data.long, data.long$wave == 5)
smocc.wave6 <- subset(data.long, data.long$wave == 6)
smocc.wave7 <- subset(data.long, data.long$wave == 7)
smocc.wave8 <- subset(data.long, data.long$wave == 8)
smocc.wave9 <- subset(data.long, data.long$wave == 9)

# Object to save results
results.d <- matrix(c(NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA), 
                    nrow = 9, ncol = 2)
colnames(results.d) <- c("Esimate D-score", "$R^2$")
rownames(results.d) <- c("wave 1", "wave 2", "wave 3", "wave 4", "wave 5", "wave 6", "wave 7", "wave 8", "wave 9")

# WAVE 1
mod.wave1 <- lm(IQ ~ dscore, data = smocc.wave1)
results.d[1,1] <- coefficients(mod.wave1)[2]
results.d[1,2] <- summary(mod.wave1)$r.squared 

# WAVE 2
mod.wave2 <- lm(IQ ~ dscore, data = smocc.wave2)
results.d[2,1] <- coefficients(mod.wave2)[2]
results.d[2,2] <- summary(mod.wave2)$r.squared 

# WAVE 3
mod.wave3 <- lm(IQ ~ dscore, data = smocc.wave3)
results.d[3,1] <- coefficients(mod.wave3)[2]
results.d[3,2] <- summary(mod.wave3)$r.squared 

# WAVE 4
mod.wave4 <- lm(IQ ~ dscore, data = smocc.wave4)
results.d[4,1] <- coefficients(mod.wave4)[2]
results.d[4,2] <- summary(mod.wave4)$r.squared 

# WAVE 5
mod.wave5 <- lm(IQ ~ dscore, data = smocc.wave5)
results.d[5,1] <- coefficients(mod.wave5)[2]
results.d[5,2] <- summary(mod.wave5)$r.squared 

# WAVE 6
mod.wave6 <- lm(IQ ~ dscore, data = smocc.wave6)
results.d[6,1] <- coefficients(mod.wave6)[2]
results.d[6,2] <- summary(mod.wave6)$r.squared 

# WAVE 7
mod.wave7 <- lm(IQ ~ dscore, data = smocc.wave7)
results.d[7,1] <- coefficients(mod.wave7)[2]
results.d[7,2] <- summary(mod.wave7)$r.squared 

# WAVE 8
mod.wave8 <- lm(IQ ~ dscore, data = smocc.wave8)
results.d[8,1] <- coefficients(mod.wave8)[2]
results.d[8,2] <- summary(mod.wave8)$r.squared 

# WAVE 9
mod.wave9 <- lm(IQ ~ dscore, data = smocc.wave9)
results.d[9,1] <- coefficients(mod.wave9)[2]
results.d[9,2] <- summary(mod.wave9)$r.squared 


tableIQonlyD <- results.d
```

```{r, tableIQonlyD, echo=FALSE}
#library(knitr)
#kable(tableIQonlyD, caption = "Estimates of the D-score and the $R^2$ for the regression models where only D-score is used as explanatory variable", booktabs = TRUE, digits = 4)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
results.d1 <- as.data.frame(results.d)
names(results.d1) <- c("estimate", "R2")
results.d1$wave <- c(1,2,3,4,5,6,7,8,9)

pest <- ggplot(results.d1, aes(wave, estimate)) +
      geom_point( )+
      scale_y_continuous(breaks = seq(0, 1, 0.2),
                         name = "estimate D-score") +
      scale_x_continuous(breaks = seq(1, 10, 2), name = "Wave") 

pR2 <- ggplot(results.d1, aes(wave, R2)) +
      geom_point( )+
      scale_y_continuous(breaks = seq(0, 0.04, 0.01), 
                         name = "R-squared") +
      scale_x_continuous(breaks = seq(1, 10, 2), name = "Wave") 
```

```{r, graphestR2, echo = FALSE,  fig.cap="\\label{fig:graphestR2} The estimate for the D-score and $R^2$ plotted for each wave", message=FALSE, warning=FALSE}

#arrange
ggarrange(pest, pR2, ncol=2, nrow=1)

```

In figure \@ref(fig:graphestR2), we can see that the estimates for the D-score and the $R^2$ are the highest for wave 7 and wave 9. Indicating that the D-score at wave 7 and wave 9 has the largest effect on IQ at 5 years and explain the most variation in IQ at 5 years. In addition, figure \@ref(fig:graphestR2) shows that the D-score of the first four waves barely explains any variation in IQ at 5 years. Thus, the D-scores of the first six months is not capable of explaining the variation in IQ at 5 years. Hence, the D-score when the children are older is better in explaining the variation in IQ at 5 years. 

Secondly, we can add explanatory variables to the regression model to control for confounding effects. For example, the education level of the mother can also partly explain the variation in IQ at 5 years, so it is important to add these to your prediction model. To predict IQ at 5 years, the following explanatory variables are added to the regression model:

- gender
- birthweight
- birthsize
- agemom: age mother
- edumocat: low, middle or high education level of the mother
- age
- D-score

The first five variables are constant over the waves, while the other two variables vary over time.

For each wave we have estimated two models, *model 1* including all variables as listed above, and *model 2* including all variables except for the D-score. Then, we can compare the explained variation of IQ at 5 years old of both models by comparing the adjusted $R^2$. We have chosen for the adjusted $R^2$ since it corrects for the number of variables added to the model: the $R^2$ will always get higher when a new variable is added to the model. In this way, we can see how much of the variation in IQ is explained by adding the D-score to the regression model for each wave.

```{r, echo=FALSE}

# Object to save results
results <- matrix(c(NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA,
                    NA, NA, NA, NA, NA, NA, NA, NA, NA), nrow = 9, ncol = 7)
colnames(results) <- c("Esimate D-score", "95% CI LL", "95% CI UL", "p-value", 
                       "model 1 adj. $R^2$", "model 2 adj. $R^2$", "diff. adj. $R^2$")
rownames(results) <- c("wave 1", "wave 2", "wave 3", "wave 4", "wave 5", "wave 6", 
                       "wave 7", "wave 8", "wave 9")


#In veel waves zijn de haz en waz voor veel kinderen NA.
#Deze wel toevoegen aan het grote model???

# WAVE 1
model.wave1 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave1)
results[1,1] <- coefficients(model.wave1)[5]
results[1,2] <- confint(model.wave1, level = 0.95)[8, 1]
results[1,3] <- confint(model.wave1, level = 0.95)[8, 2]
results[1,4] <- summary(model.wave1)$coefficients[8,4]  
results[1,5] <- summary(model.wave1)$adj.r.squared 
model.wave1.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize + factor(edumocat) + agemom, data = smocc.wave1)
results[1,6] <- summary(model.wave1.wd)$adj.r.squared 
results[1,7] <- results[1,5] - results[1,6]

# WAVE 2
model.wave2 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave2)
results[2,1] <- coefficients(model.wave2)[5]
results[2,2] <- confint(model.wave2, level = 0.95)[8, 1]
results[2,3] <- confint(model.wave2, level = 0.95)[8, 2]
results[2,4] <- summary(model.wave2)$coefficients[8,4]  
results[2,5] <- summary(model.wave2)$adj.r.squared
model.wave2.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave2)
results[2,6] <- summary(model.wave2.wd)$adj.r.squared 
results[2,7] <- results[2,5] - results[2,6]

# WAVE 3
model.wave3 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave3)
results[3,1] <- coefficients(model.wave3)[5]
results[3,2] <- confint(model.wave3, level = 0.95)[8, 1]
results[3,3] <- confint(model.wave3, level = 0.95)[8, 2]
results[3,4] <- summary(model.wave3)$coefficients[8,4]  
results[3,5] <- summary(model.wave3)$adj.r.squared
model.wave3.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave3)
results[3,6] <- summary(model.wave3.wd)$adj.r.squared 
results[3,7] <- results[3,5] - results[3,6]

# WAVE 4
model.wave4 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave4)
results[4,1] <- coefficients(model.wave4)[5]
results[4,2] <- confint(model.wave4, level = 0.95)[8, 1]
results[4,3] <- confint(model.wave4, level = 0.95)[8, 2]
results[4,4] <- summary(model.wave4)$coefficients[8,4]  
results[4,5] <- summary(model.wave4)$adj.r.squared
model.wave4.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave4)
results[4,6] <- summary(model.wave4.wd)$adj.r.squared 
results[4,7] <- results[4,5] - results[4,6]

# WAVE 5
model.wave5 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave5)
results[5,1] <- coefficients(model.wave5)[5]
results[5,2] <- confint(model.wave5, level = 0.95)[8, 1]
results[5,3] <- confint(model.wave5, level = 0.95)[8, 2]
results[5,4] <- summary(model.wave5)$coefficients[8,4]  
results[5,5] <- summary(model.wave5)$adj.r.squared
model.wave5.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave5)
results[5,6] <- summary(model.wave5.wd)$adj.r.squared 
results[5,7] <- results[5,5] - results[5,6]

# WAVE 6
model.wave6 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave6)
results[6,1] <- coefficients(model.wave6)[5]
results[6,2] <- confint(model.wave6, level = 0.95)[8, 1]
results[6,3] <- confint(model.wave6, level = 0.95)[8, 2]
results[6,4] <- summary(model.wave6)$coefficients[8,4]  
results[6,5] <- summary(model.wave6)$adj.r.squared 
model.wave6.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave6)
results[6,6] <- summary(model.wave6.wd)$adj.r.squared 
results[6,7] <- results[6,5] - results[6,6]

# WAVE 7
model.wave7 <- lm(IQ ~ factor(male) + age + birthweight + birthsize + haz + waz
                  + factor(edumocat) + dscore + agemom, data = smocc.wave7)
results[7,1] <- coefficients(model.wave7)[5]
results[7,2] <- confint(model.wave7, level = 0.95)[8, 1]
results[7,3] <- confint(model.wave7, level = 0.95)[8, 2]
results[7,4] <- summary(model.wave7)$coefficients[8,4]  
results[7,5] <- summary(model.wave7)$adj.r.squared
model.wave7.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave7)
results[7,6] <- summary(model.wave7.wd)$adj.r.squared 
results[7,7] <- results[7,5] - results[7,6]

# WAVE 8
model.wave8 <- lm(IQ ~ factor(male) + age+ birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave8)
results[8,1] <- coefficients(model.wave8)[5]
results[8,2] <- confint(model.wave8, level = 0.95)[8, 1]
results[8,3] <- confint(model.wave8, level = 0.95)[8, 2]
results[8,4] <- summary(model.wave8)$coefficients[8,4]  
results[8,5] <- summary(model.wave8)$adj.r.squared
model.wave8.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave8)
results[8,6] <- summary(model.wave8.wd)$adj.r.squared 
results[8,7] <- results[8,5] - results[8,6]

# WAVE 9
model.wave9 <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                  + factor(edumocat) + dscore + agemom, data = smocc.wave9)
results[9,1] <- coefficients(model.wave9)[5]
results[9,2] <- confint(model.wave9, level = 0.95)[8, 1]
results[9,3] <- confint(model.wave9, level = 0.95)[8, 2]
results[9,4] <- summary(model.wave9)$coefficients[8,4]  
results[9,5] <- summary(model.wave9)$adj.r.squared
model.wave9.wd <- lm(IQ ~ factor(male) + age + birthweight + birthsize 
                     + factor(edumocat) + agemom, data = smocc.wave9)
results[9,6] <- summary(model.wave9.wd)$adj.r.squared 
results[9,7] <- results[9,5] - results[9,6]

#Misschien beter om de DAZ er in te doen?!

```

The estimates for the predictor D-score, and it's 95\% confidence interval are given in table \@ref(tab:tableIQ). Moreover, it contains the p-values for the predictor D-score in *model 1* and the adjusted $R^2$'s for *model 1* and *model 2*. The adjusted $R^2$ determines the explained variation in the outcome measure, in this case IQ at 5 years, while penalizing for the number of predictors in the model. Comparison of the $R^2$ is not feasible, since it will always increase when another predictor is added to the model.

```{r, tableIQ, echo=FALSE}
library(knitr)
kable(results, caption = "Comparison of the models per wave to explain IQ at 5 years by D-score", booktabs = TRUE, digits = 4)
```

From table \@ref(tab:tableIQ) we can see that the D-score does not explain variation in IQ at 5 years for the first 6 waves. In other words, the D-scores until the age of 1 year will not explain the variation in IQ at the age of 5 years. However, for wave 7, at the age of 15 months, the estimate for the D-score is just significant and explains almost 3\% of the variation in IQ at the age of 5 years. There is also an almost significant effect of the D-score on IQ at waves 8 and 9, however this only explains around 0.5\% of the variation in IQ at 5 years.
