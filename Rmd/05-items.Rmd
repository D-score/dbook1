# Interpretation of item fit {#items} (IE)

## SMOCC data: design

To illustrate the interpretation of fit measures for the D-score we use the SMOCC study (Herngreen et al, 1993), which covers the age range 0-2 years. In the SMOCC study 57 items are asssesed to measure the D-score. 

```{r smocc data, include=FALSE}
smocc <- ddata::get_gcdg(study="Netherlands 1", adm = TRUE)

```


## Empirical and fitted item response curves

The fit of a Rasch model can be visually inspected by comparing the observed probability of endorsing an item to the fitted item response curve for endorsing the item. The fitted item response curve for each item $i$ is modeled as: $$E_{ni}= \frac{exp( \beta_{n} - \delta_{i} )}{1+exp(\beta_{n}-\delta_{i})}$$, where $\beta_n$ is the ability of person $n$ and $\delta_i$ is the difficulty of item $i$. In the Figure below, the item characteristics curve can be obverved for an example item "n5" and item "n38". It can be observed that for both items the observed data (orange line) fits nicely to the estimated item response curve (dashed line).  


```{r icc, include=FALSE}
smocc <- ddata::get_gcdg(study="Netherlands 1", adm = TRUE)
varlist <- dmetric::prepare_items(study = "Netherlands 1")
#equatelist <- dmetric::prepare_equates(varlist)
#model_name<- "smocc1"
#model <- dmetric::fit_dmodel(varlist=varlist,eqate=equatelist, name = model_name)
#plots_d <- dmetric::plot_p_d_item(data=smocc, model = fit)
#plots_d[["n40"]]
#delta <- dmetric::rasch(smocc[,varlist$items])$b
#itembank <- dmetric::calculate_itembank(tau=delta)
#theta <- dmetric::calculate_dscore(data=smocc, items=varlist$items, itembank=itembank)
library(ltm)
 ltmrm <- ltm::rasch(smocc[,varlist$items])
 plotltm <- ltm::plot.rasch(ltmrm,type="ICC")
```

```{r echo=FALSE}
 
 library(ggplot2)
ggplot(as.data.frame(plotltm), aes(x=z, y=n5)) + geom_line()+ xlab("Ability (theta)")+ ylab("Probability to pass")+ggtitle("Item Characteristic Curve", subtitle=paste(ddata::get_itemtable(items="n5")[1,c("item", "label")], collapse = ": "))
ggplot(as.data.frame(plotltm), aes(x=z, y=n38)) + geom_line()+ xlab("Ability (theta)")+ ylab("Probability to pass")+ggtitle("Item Characteristic Curve", subtitle=paste(ddata::get_itemtable(items="n38")[1,c("item", "label")], collapse = ": "))

```

## Item fit

The fit of the items evaluate the extent to which data performs with the construction of measurement. An assumption of the Rasch model is that items with a lower difficulty will always have a higher probability to pass in comparison to items with a higher difficulty level. Fit analysis evaluates the extend to which this is true for each item. Two types of item fit are distinguished: the item outfit and the item infit. The outfit evaluates the extent to which the responses to the items are consistent with the model. In other words wheter items with a lower difficulty also have a higher probability to pass. The outfit statistic is heavity infulenced by outlying responses that do not fit the expected pattern. The infit is the information weighted fit and is more sensitive to inlying, on-target, unexpected responses. 

To determine the fit of items to the model we compare the observed responses and the expected values. The observed response $x_{ni}$ of person $n$ on item $i$ can be $0$ or $1$. The expected response $E_{ni}$ is modelled as $$E_{ni}= \frac{exp( \beta_{n} - \delta_{i} )}{1+exp(\beta_{n}-\delta_{i})}$$. The difference between the observed and the expected responses are the residual errors. The item infit is the sum of the squared errors divided by the sum of the expected response variances $W_{ni}$. The expected response variance $W_{ni}$ can be obtained as $E_{ni}(1-E_{ni})$. The outfit is calculated as the sum of the squared standardizes errors. The residual errors are standardized by dividing by the expected binomial standard deviation: $$z_{ni} = \frac{x_{ni}-E_{ni}}{\sqrt{W_{ni}}}$$. Accordingly the infit and outfit are calculated as: $$Infit = \frac{\sum_{n}^N (x_{ni}-E_{ni})^2}{\sum_n^N W_{ni}}$$
   $$Outfit = \frac{\sum_{n}^N z_{ni}^2}{N}$$. 

## Item information at a given ability

The item information can be calculated as the amount of psychometric information an item contains for a given ability. The formula for the item information can be written as follows: $$I(\theta)=P_i(\theta)(1-P_i(\theta))$$, where $P_i(\theta)$ is the conditional probability of endorsing an item. 
The implications of the item information are first that the amount of infformation an item provides is maximized around the item-difficulty parameter. 

```{r, include=FALSE}
 ltmrm <- ltm::rasch(smocc[,varlist$items])
 plotltm2 <- ltm::plot.rasch(ltmrm,type="IIC")
```

```{r, echo=FALSE}
 library(ggplot2)
ggplot(as.data.frame(plotltm2), aes(x=z, y=n5)) + geom_line()+ xlab("Ability (theta)")+ ylab("Item information")+ggtitle("Item Characteristic Curve", subtitle=paste(ddata::get_itemtable(items="n5")[1,c("item", "label")], collapse = ": "))
ggplot(as.data.frame(plotltm2), aes(x=z, y=n38)) + geom_line()+ xlab("Ability (theta)")+ ylab("Item information")+ggtitle("Item Characteristic Curve", subtitle=paste(ddata::get_itemtable(items="n38")[1,c("item", "label")], collapse = ": "))

```



## Item information at a given age

```{r, include=FALSE}

```

